<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>第一个three.js文件_WebGL三维场景</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            /* 隐藏body窗口区域滚动条 */
        }
    </style>
</head>

<body>
    <script type="module">
        import * as THREE from './three/src/Three.js';
        import { Reflector } from './three/examples/jsm/objects/Reflector.js';
        import { OrbitControls } from './three/examples/jsm/controls/OrbitControls.js';
        import { Line2 } from './three/examples/jsm/lines/Line2.js';
        import { LineMaterial } from './three/examples/jsm/lines/LineMaterial.js';
        import { LineGeometry } from './three/examples/jsm/lines/LineGeometry.js';
        import { FontLoader } from './three/src/loaders/FontLoader.js';
        import { TextGeometry } from './three/src/geometries/TextGeometry.js';

        /**
         * 创建场景对象Scene
         */
        let controls;
        let camera, scene, renderer;
        let width=window.innerWidth, height= window.innerHeight;


        function initScene() {
            scene = new THREE.Scene();
        }


        /**
        * 创造镜面
        */
        function createMirrors() {
            var planeGeometry = new THREE.PlaneGeometry(350, 350);
            const mirror = new Reflector(planeGeometry, {
                clipBias: 0.03,
                textureWidth: window.innerWidth * window.devicePixelRatio,
                textureHeight: window.innerHeight * window.devicePixelRatio,
                color: 0x317fef,
            });
            scene.add(mirror);
        }

        function addText(context, x = 0, y = 0, z = 0) {
            const loader = new FontLoader();
            //加载字体库
            loader.load('./three/examples/fonts/gentilis_regular.typeface.json', font => {
                var geometry = new TextGeometry(context, { //第一个参数是所需字体，第二个参数是字体属性
                    font: font,
                    size: 20,
                    height: 1,
                    curveSegments: 12,
                    bevelEnabled: true,
                    bevelThickness: 1,
                    bevelSize: 0,
                    bevelSegments: 3
                });
                var mesh = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({ color: '#282c34' }));
                mesh.position.set(x, y, z)
                scene.add(mesh);
            });
        }


        function createAxes() {
            // 坐标轴的设置（正负轴）
            var axes = new THREE.AxesHelper(200);
            scene.add(axes);
            var unaxes = new THREE.AxesHelper(-200);
            scene.add(unaxes);
        }



        // 画线
        function lineObject(x, y, z) {
            var geometry = new LineGeometry();
            var material = new LineMaterial({ color: 0xFF0000, resolution: new THREE.Vector2(800, 600) });
            var pointArr = new Float32Array([
                0, 0, 0, // 向量OP
                x, y, z,
            ]);
            geometry.setPositions(pointArr)
            var line = new THREE.Line(geometry, material);
            scene.add(line);
        }
        // 圆体
        function sphereObject(x, y, z) {
            var geometry = new THREE.SphereGeometry(5, 32, 32);
            var material = new THREE.MeshBasicMaterial({ color: 0xffff00 });
            var sphere = new THREE.Mesh(geometry, material);
            sphere.position.set(x, y, z);
            scene.add(sphere);
        }
        // 画圆锥（箭头）
        function coneObject(x, y, z, falg) {

            var ConeGeometry = new THREE.ConeGeometry(5, 15, 30);
            var ConeGeometrys = new THREE.ConeGeometry(2, 10, 30);
            var ConerMaterial = new THREE.MeshLambertMaterial({
                'color': 'red',
                'side': THREE.DoubleSide
            })
            var coneMesh;
            // 箭头含义不同，大小不同
            if (falg) {
                coneMesh = new THREE.Mesh(ConeGeometrys, ConerMaterial)
            } else {
                coneMesh = new THREE.Mesh(ConeGeometry, ConerMaterial)
            }


            // 箭头方法
            if (x == 0) {
                coneMesh.position.set(0, y - 5, 0)
                if (y < 0) {
                    coneMesh.rotateX(Math.PI)
                }
            }
            if (y == 0) {
                coneMesh.position.set(x - 5, 0, 0)
                if (x > 0) {
                    coneMesh.rotateZ(-Math.PI / 2)
                } else {
                    coneMesh.rotateZ(Math.PI / 2)
                }

            }
            if (x != 0 && y != 0 && z == 0) {
                var x1 = Math.abs(x)
                var y1 = Math.abs(y)
                var deg = -Math.atan2(y1, x1)
                coneMesh.position.set(x, y, 0)
                if (x > 0 && y > 0) {
                    coneMesh.rotateZ(deg)
                }
                if (x < 0 && y > 0) {
                    coneMesh.rotateZ(deg + Math.PI / 2)
                }
                if (x > 0 && y < 0) {
                    coneMesh.rotateZ(deg - Math.PI / 2)
                }
                if (x < 0 && y < 0) {
                    coneMesh.rotateZ(deg - Math.PI)
                }

            }
            if (x != 0 && y != 0 && z != 0) {
                coneMesh.position.set(x - 5, y - 5, z - 5)
            }
            if (x == 0 && y == 0 && z != 0) {
                coneMesh.position.set(0, 0, z - 5)
                coneMesh.rotateX(Math.PI / 2)
            }
            scene.add(coneMesh)
        }

        // 初始化界面绘制OP投影
        function initObject(x, y, z) {
            createMirrors();  //创建镜面
            createAxes();  //创建坐标轴
            createLight();

            // 向量OP端点
            sphereObject(0, 0, 0);
            sphereObject(x, y, z);
            // 添加字体到坐标轴中
            addText('O')
            addText('P', 110, 110, 110)

            // 坐标轴正方向（箭头）
            coneObject(200, 0, 0, true);
            coneObject(0, 200, 0, true);
            coneObject(0, 0, 200, true);
            // line初始化
            lineObject(x, y, z);
        }


        /**
        * 光源设置
        */
        function createLight() {
            //点光源
            var point = new THREE.PointLight(0xffffff);
            point.position.set(400, 200, 300); //点光源位置
            scene.add(point); //点光源添加到场景中
            //环境光
            var ambient = new THREE.AmbientLight(0x444444);
            scene.add(ambient);
        }

        /**
         * 相机设置
         */
        function initCamera() {
            camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
            camera.position.set(0, 190, 280)
            camera.lookAt(new THREE.Vector3(0, 0, 0));
        }


        /**
         * 创建渲染器对象
         */

        function initRender() {
            renderer = new THREE.WebGLRenderer({
                antialias: true,     //抗锯齿
                alpha: true
            });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(width, height);//设置渲染区域尺寸
            renderer.setClearColor(0xb9d3ff, 1); //设置背景颜色
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement); //body元素中插入canvas对象
            initControls();
        }

        function render() {
            renderer.render(scene, camera);//执行渲染操作
            camera.updateProjectionMatrix(); //相机属性发生变化更新投影矩阵
        }

        function initControls() {
            controls = new OrbitControls(camera, renderer.domElement);//创建控件对象
            controls.addEventListener('change', render);
        }


        function init() {
            initScene();
            initCamera();
            initRender();
            // initControls();
            initObject(100, 100, 100);
            render();
        }

        window.onload = init;

    </script>
</body>

</html>